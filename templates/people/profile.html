{% extends "people/base.html" %}
{% load cache %}
{% load people %}
{% load projects %}
{% load media %}

{% block title %}{{block.super}} - {% display_name p_user %}{% endblock %}



{% block body %}
<div id="person" class="module vcard">
    <div id="personPic">
        {# gravatar p_user.email #}
    </div>
    <div id="personDetails">
        <div id="personHeader">
            {% if p_user.first_name %}
                <h2 class="fn">{{p_user.first_name}}</h2>
            {% else %}
                <h2 class="fn nickname">{{p_user.username}}</h2>
            {% endif %}
            {% ifequal user.id p_user.id %}
                <a href="{% url edit_profile %}">(edit profile)</a>
            {% endifequal %}
            <span id="personIdentifier" class="role">{{p_user.profile.get_role_display|safe}}</span>
        </div>
        <div id="userDetails" class="module">
            <dl>
                <dt>Website:</dt>
                <dd id="userWebsite"><a class="url" rel="me" href="{{p_user.profile.url|default:"#"}}">{{p_user.profile.url|default:"n/a"}}</a></dd>

                <dt id="userLocation">Location:</dt>
                <dd>{{p_user.profile.location|default:"n/a"}}</dd>
                <div class="clear"></div>
            </dl>
            <p>
            {{p_user.profile.about}}
            </p>

            {% if user.is_authenticated %}
                <a id="contactBtn" href="{% url contact_user p_user.username %}">Contact</a>
            {% endif %}
        </div>
    </div>
    <div id="personProject">
        <h3 class="leftH3">{% possessive p_user %} Projects</h3>
        <div id="projectModule" class="module">
            <div id="leadProjects">
                <h4>Lead</h4>
                {% if p_user.projects_lead_on.all %}
                    <ul>
                    {% for project in p_user.projects_lead_on.all %}
                    <li><a class="projectName" href="{{project.get_absolute_url}}">{{project}}</a>

                    {# only show link if user==p_user==project.lead #}
                    {% ifequal user p_user %}
                    {% ifequal user project.lead %}<a class="projectEdit" href="{% url edit_project project.slug %}">edit project</a>{% endifequal %}
                    {% endifequal %}
                    </li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p>{{p_user.first_name}} hasn't lead any projects just yet.</p>
                {% endif %}
            </div>
            <div id="helpedProjects">
                <h4>Helped</h4>
                {% with p_user.project_roles.active.select_related as helped_projects %}
                {% if helped_projects %}
                <ul>
                    {% for r in helped_projects %}
                        <li><a href="{{r.project.get_absolute_url}}">{{r.project}}</a></li>
                    {% endfor %}
                </ul>
                {% else %}
                    <p>{{p_user.first_name}} hasn't helped on any projects just yet.</p>
                {% endif %}
                {% endwith %}
            </div>
        </div>
    </div>
    
</div>
{% endblock %}

